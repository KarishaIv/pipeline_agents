# Credit Decision Prediction Pipeline with Multi-Agent Simulation

–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –±–∞–Ω–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏–π –æ –∫—Ä–µ–¥–∏—Ç–µ. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Probabilistic Graphical Models (PGM) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –ø–µ—Ä—Å–æ–Ω, k-NN matching –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –ª–∏—á–Ω–æ—Å—Ç–Ω—ã—Ö —á–µ—Ä—Ç –∏–∑ –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ (Nemotron), –∏ –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω—É—é —Å–∏–º—É–ª—è—Ü–∏—é –Ω–∞ –±–∞–∑–µ LLM –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è —ç–º–æ—Ü–∏–π, –ø–æ–≤–µ–¥–µ–Ω–∏—è –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π.

---

## üìä –°—Ö–µ–º–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞

![–°—Ö–µ–º–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞](diagram.png)

---

## üöÄ –ó–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.10+
- OpenAI API –∫–ª—é—á
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—Å–º. `requirements.txt`)

### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫
```bash
python main.py --api_key YOUR_OPENAI_API_KEY
```

### –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
```bash
python main.py \
  --api_key YOUR_OPENAI_API_KEY \
  --evidence data/evidence.json \
  --synthetic_size 100 \
  --nemo_size 5000 \
  --output outputs/ \
  --simulation_steps 3 \
  --concurrency 4 \
  --timeout 180.0
```

---

## ‚öôÔ∏è –ì–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|-------------|----------|
| `--api_key` | str | **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π** | OpenAI API –∫–ª—é—á –¥–ª—è LLM –≤—ã–∑–æ–≤–æ–≤ |
| `--evidence` | str | `data/evidence.json` | –ü—É—Ç—å –∫ JSON —Å evidence-–¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è PGM, —Å–∞–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ—Ü–∏–∞–ª—å–Ω—É—é –≥—Ä—É–ø–ø—É –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è |
| `--synthetic_size` | int | 10 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –ø–µ—Ä—Å–æ–Ω |
| `--nemo_size` | int | 5000 | –†–∞–∑–º–µ—Ä –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ (Nemotron) |
| `--output` | str | `outputs/` | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ |
| `--simulation_steps` | int | 2 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –≤ –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏ |
| `--concurrency` | int | 3 | –ß–∏—Å–ª–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Å–∏–º—É–ª—è—Ü–∏–π –ø–µ—Ä—Å–æ–Ω |
| `--timeout` | float | 180.0 | –¢–∞–π–º–∞—É—Ç –Ω–∞ –æ–¥–Ω—É –ø–µ—Ä—Å–æ–Ω—É (—Å–µ–∫—É–Ω–¥—ã) |

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `config.py`

```python
# K-NN –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
TOP_N_CATEGORIES = 10      # –¢–æ–ø-N –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
TOP_N_NEIGHBORS = 10       # –¢–æ–ø-N –±–ª–∏–∂–∞–π—à–∏—Ö –∞–º–µ—Ä–∏–∫–∞–Ω—Ü–µ–≤

# –†–∞–∑–º–µ—Ä—ã –¥–∞—Ç–∞—Å–µ—Ç–æ–≤
DEFAULT_SYNTHETIC_SIZE = 10
DEFAULT_NEMO_SIZE = 5000

# –ü—É—Ç–∏ –∫ –¥–∞–Ω–Ω—ã–º
DATA_PATHS = {
    'evidence': 'data/evidence.json',
    'synthetic_data': 'data/synthetic_personas.csv',
    'nemotron_data': 'data/nemotron_americans.csv'
}
```

---

## üìñ –û–±—â–∞—è –∏–¥–µ—è —ç—Ç–∞–ø–æ–≤

### –≠—Ç–∞–ø 1-4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –ø–µ—Ä—Å–æ–Ω (PGM)

**–¶–µ–ª—å**: –°–æ–∑–¥–∞—Ç—å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ –¥–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

**–ü—Ä–æ—Ü–µ—Å—Å**:
1. **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö**: –°—á–∏—Ç—ã–≤–∞–µ–º evidence (—É—Å–ª–æ–≤–∏—è –∑–∞–ø—Ä–æ—Å–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, "–º—É–∂—á–∏–Ω–∞ 30-40 –ª–µ—Ç, –ú–æ—Å–∫–≤–∞") –∏ –±–∞–∑–æ–≤—ã–π –¥–∞—Ç–∞—Å–µ—Ç (—Ä–µ–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ)
2. **Preprocessing**: –î–∏—Å–∫—Ä–µ—Ç–∏–∑–∏—Ä—É–µ–º continuous –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–≤–æ–∑—Ä–∞—Å—Ç, –¥–æ—Ö–æ–¥ ‚Üí –≥—Ä—É–ø–ø—ã)
3. **–û–±—É—á–µ–Ω–∏–µ PGM**: –°—Ç—Ä–æ–∏–º Discrete Bayesian Network —Å –∫–∞—É–∑–∞–ª—å–Ω—ã–º–∏ —Å–≤—è–∑—è–º–∏:
   ```
   age_group ‚Üí marital_status
   age_group ‚Üí children_group
   education ‚Üí occupation ‚Üí income_level
   region_type ‚Üí income_level
   ...
   ```
4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ–º likelihood-weighted sampling —Å evidence, —á—Ç–æ–±—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å N —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –ø–µ—Ä—Å–æ–Ω, —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å—É evidence

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: DataFrame —Å —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ä–æ—Å—Å–∏–π—Å–∫–∏–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–º–∏ (–¥–µ–º–æ–≥—Ä–∞—Ñ–∏—è –±–µ–∑ OCEAN)

---

### –≠—Ç–∞–ø 5-8: Transfer OCEAN –∏–∑ –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞

**–¶–µ–ª—å**: –ù–∞–∑–Ω–∞—á–∏—Ç—å –∫–∞–∂–¥–æ–π —Ä–æ—Å—Å–∏–π—Å–∫–æ–π –ø–µ—Ä—Å–æ–Ω–µ –ª–∏—á–Ω–æ—Å—Ç–Ω—ã–µ —á–µ—Ä—Ç—ã (Big Five OCEAN).

**–ü—Ä–æ–±–ª–µ–º–∞**: –£ –Ω–∞—Å –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö OCEAN –¥–ª—è —Ä–æ—Å—Å–∏—è–Ω, –Ω–æ –µ—Å—Ç—å –¥–ª—è –∞–º–µ—Ä–∏–∫–∞–Ω—Ü–µ–≤ (Nemotron).

**–†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ k-NN**:

1. **Category Matching**: –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º –∞–º–µ—Ä–∏–∫–∞–Ω—Ü–µ–≤ —Å –ø–æ—Ö–æ–∂–∏–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ (–ø–æ–ª, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ—Ñ–µ—Å—Å–∏—è - –≤—Å–µ —á—Ç–æ –µ—Å—Ç—å –ø–æ —Å–æ—Ü.–¥–µ–º–æ–≥—Ä–∞—Ñ–∏–∏)
   - –í—ã—á–∏—Å–ª—è–µ–º Euclidean distance –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
   - –û—Ç–±–∏—Ä–∞–µ–º —Ç–æ–ø-10 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
   - –°–æ–∑–¥–∞—ë–º filtered pool –∞–º–µ—Ä–∏–∫–∞–Ω—Ü–µ–≤

2. **k-NN**: –î–ª—è –∫–∞–∂–¥–æ–π —Ä–æ—Å—Å–∏–π—Å–∫–æ–π –ø–µ—Ä—Å–æ–Ω—ã:
   - –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –≤—Å–µ—Ö –∞–º–µ—Ä–∏–∫–∞–Ω—Ü–µ–≤ –∏–∑ filtered pool
   - –ù–∞—Ö–æ–¥–∏–º k=10 –±–ª–∏–∂–∞–π—à–∏—Ö —Å–æ—Å–µ–¥–µ–π
   - –ò–∑–≤–ª–µ–∫–∞–µ–º –∏—Ö OCEAN –ø—Ä–æ—Ñ–∏–ª–∏ —á–µ—Ä–µ–∑ –∞–≥–µ–Ω—Ç–∞

3. **–ê–≥—Ä–µ–≥–∞—Ü–∏—è OCEAN**:
   - –í—ã—á–∏—Å–ª—è–µ–º mean –∏ std –ø–æ OCEAN —Å–æ—Å–µ–¥–µ–π
   - –î–æ–±–∞–≤–ª—è–µ–º –∫ –ø—Ä–æ—Ñ–∏–ª—é —Ä–æ—Å—Å–∏–π—Å–∫–æ–π –ø–µ—Ä—Å–æ–Ω—ã –∫–∞–∫ `openness_mean`, `openness_std`, etc.

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –†–æ—Å—Å–∏–π—Å–∫–∏–µ –ø–µ—Ä—Å–æ–Ω—ã —Å –¥–µ–º–æ–≥—Ä–∞—Ñ–∏–µ–π + OCEAN —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

---

### –≠—Ç–∞–ø 9: Multi-Agent Simulation (–Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã)

**–¶–µ–ª—å**: –°–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ —Å –±–∞–Ω–∫–æ–≤—Å–∫–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è –æ –∫—Ä–µ–¥–∏—Ç–µ.

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã**:

```
MultiAgentSystem (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)
  ‚îÇ
  ‚îú‚îÄ‚îÄ PersonaAgent (–∫–ª–∏–µ–Ω—Ç)
  ‚îÇ     ‚îú‚îÄ‚îÄ EmotionAgent (—ç–º–æ—Ü–∏–∏)
  ‚îÇ     ‚îî‚îÄ‚îÄ ToolAgent (–æ—Ç–≤–µ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
  ‚îÇ
  ‚îú‚îÄ‚îÄ FinancialAgent (–±–∞–Ω–∫)
  ‚îÇ
  ‚îî‚îÄ‚îÄ DecisionAgent (—Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)
```

#### 9.1 PersonaAgent ‚Äî –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**:
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ü–µ–ª—å –≤–∏–∑–∏—Ç–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (—á–µ—Ä–µ–∑ LLM): "–æ—Ñ–æ—Ä–º–∏—Ç—å –∫—Ä–µ–¥–∏—Ç", "–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å", "–æ–ø–ª–∞—Ç–∏—Ç—å —Å—á–µ—Ç–∞", etc.
- EmotionAgent —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (mood, stress, confidence, bank_trust, urgency)

**–¶–∏–∫–ª —Å–∏–º—É–ª—è—Ü–∏–∏ (N —à–∞–≥–æ–≤)**:
–ö–∞–∂–¥—ã–π —à–∞–≥ = –æ–¥–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:

1. **PersonaAgent.act_step()**:
   - LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
     - –¶–µ–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞
     - –¢–µ–∫—É—â–∏—Ö —ç–º–æ—Ü–∏–π
     - –ò—Å—Ç–æ—Ä–∏–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
   - –ü—Ä–∏–º–µ—Ä: "–Ω–∞–∂–∞–ª –Ω–∞ —Ä–∞–∑–¥–µ–ª –ö—Ä–µ–¥–∏—Ç—ã", "–æ—Ç–∫—Ä—ã–ª –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫—Ä–µ–¥–∏—Ç–∞", "–∑–∞–ø—Ä–æ—Å–∏–ª —É—Å–ª–æ–≤–∏—è"

2. **ToolAgent.respond()**:
   - –°–∏–º—É–ª–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –ü—Ä–∏–º–µ—Ä—ã: "–ø–æ–∫–∞–∑–∞–ª —Å–ø–∏—Å–æ–∫ –∫—Ä–µ–¥–∏—Ç–æ–≤", "–æ–¥–æ–±—Ä–∏–ª –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é –∑–∞—è–≤–∫—É", "–≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É"

3. **EmotionAgent.update_state()**:
   - –û–±–Ω–æ–≤–ª—è–µ—Ç —ç–º–æ—Ü–∏–∏ –ø–æ—Å–ª–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ –æ—Ç–≤–µ—Ç–∞
   - –ï—Å–ª–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ ‚Üí stress‚Üì, confidence‚Üë
   - –ï—Å–ª–∏ –æ—Ç–∫–∞–∑ ‚Üí stress‚Üë, confidence‚Üì, bank_trust‚Üì

4. **–ò—Å—Ç–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è**: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∑–∞–ø–∏—Å—å (action, tool_response, emotional_state)

**–†–µ–∑—É–ª—å—Ç–∞—Ç —Ü–∏–∫–ª–∞**: –ò—Å—Ç–æ—Ä–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π + —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

#### 9.2 FinancialAgent ‚Äî –ì–µ–Ω–µ—Ä–∞—Ü–∏—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ N —à–∞–≥–æ–≤ —Å–∏–º—É–ª—è—Ü–∏–∏:

1. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ push** (—á–µ—Ä–µ–∑ LLM):
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: –∫—Ä–µ–¥–∏—Ç –ø–æ–¥ 12% –¥–ª—è –≤–∞—Å!"

2. **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞** (—á–µ—Ä–µ–∑ LLM):
   - –ü—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–æ–≥–ª–∞—Å–∏—è –∫–ª–∏–µ–Ω—Ç–∞
   - –û–±—ä—è—Å–Ω—è–µ—Ç reasoning

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ + prediction –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏

#### 9.3 PersonaAgent.react_to_push()

–ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç push:
- LLM –º–æ–¥–µ–ª–∏—Ä—É–µ—Ç —Ä–µ–∞–∫—Ü–∏—é: "–∑–∞–∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç—Å—è", "–ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç", "—Ä–∞–∑–¥—Ä–∞–∂–∏—Ç—Å—è"
- EmotionAgent –æ–±–Ω–æ–≤–ª—è–µ—Ç —ç–º–æ—Ü–∏–∏ –ø–æ—Å–ª–µ push

#### 9.4 DecisionAgent ‚Äî –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**–í—Ö–æ–¥**:
- –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –∫–ª–∏–µ–Ω—Ç–∞
- –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- –§–∏–Ω–∞–ª—å–Ω–æ–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ —Ä–µ–∞–∫—Ü–∏—è

**–ü—Ä–æ—Ü–µ—Å—Å** (—á–µ—Ä–µ–∑ LLM):
- –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤
- –ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è –æ—Ç –ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–∞: –±—Ä–∞—Ç—å –ª–∏ –∫—Ä–µ–¥–∏—Ç
- –£—á—ë—Ç —Ü–µ–ª–µ–π, —ç–º–æ—Ü–∏–π, —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 
```json
{
  "will_take_credit": true/false,
  "decision_reasoning": "–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ",
  "emotional_factors": ["—Å—Ç—Ä–µ—Å—Å —Å–Ω–∏–∑–∏–ª—Å—è", "–≤—ã—Å–æ–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å"],
  "probability_score": 0.75
}
```

---

### –≠—Ç–∞–ø 10: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ—Ç–æ–∫–æ–≤–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**:
- –ö–∞–∂–¥–∞—è –ø–µ—Ä—Å–æ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–∏–º—É–ª—è—Ü–∏–∏
- –ù–µ –∂–¥—ë–º –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω
- –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–±–æ—è—Ö

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:
```
outputs/
  ‚îî‚îÄ‚îÄ sim_20231105_143022/
      ‚îú‚îÄ‚îÄ persona_0_full.json      # –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Å–∏–º—É–ª—è—Ü–∏–∏
      ‚îú‚îÄ‚îÄ persona_1_full.json
      ‚îú‚îÄ‚îÄ ...
      ‚îú‚îÄ‚îÄ summary_20231105_143022.json  # –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
      ‚îî‚îÄ‚îÄ visualizations/
          ‚îú‚îÄ‚îÄ persona_0_emotions.png    # –ì—Ä–∞—Ñ–∏–∫ —ç–º–æ—Ü–∏–π
          ‚îî‚îÄ‚îÄ ...
```

**–°–æ—Ö—Ä–∞–Ω—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–µ—Ä—Å–æ–Ω—ã**:
- –ò—Å—Ö–æ–¥–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å (–¥–µ–º–æ–≥—Ä–∞—Ñ–∏—è + OCEAN)
- –¶–µ–ª—å –≤–∏–∑–∏—Ç–∞
- –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —à–∞–≥–æ–≤ (actions, tool responses, emotions)
- Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ —Ä–µ–∞–∫—Ü–∏—è
- –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏–Ω–∞–º–∏–∫–∏ —ç–º–æ—Ü–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üîß –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**SimulationManager** —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º —Å–∏–º—É–ª—è—Ü–∏–π:

```python
# –°–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
manager = SimulationManager(
    concurrency=4,      # –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ 4 –ø–µ—Ä—Å–æ–Ω—ã
    timeout=180.0,      # –¢–∞–π–º–∞—É—Ç –Ω–∞ –ø–µ—Ä—Å–æ–Ω—É
    run_retries=1       # –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ —Å–±–æ–µ
)

# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫
results = await manager.run_many(personas, steps=3)
```

**–ú–µ—Ö–∞–Ω–∏–∑–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞**:
- `asyncio.Semaphore(concurrency)` ‚Äî –Ω–µ –±–æ–ª–µ–µ N –ø–µ—Ä—Å–æ–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- `asyncio.wait_for(timeout)` ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å—à–∏—Ö —Å–∏–º—É–ª—è—Ü–∏–π
- `asyncio.as_completed()` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –º–µ—Ä–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

---

## üìö –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Agents

| Agent | –†–æ–ª—å | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ |
|-------|------|-----------|
| **PersonaAgent** | –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ | LLM (GPT), structured outputs |
| **EmotionAgent** | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π | LLM psychological prompts |
| **ToolAgent** | –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | Rule-based + LLM |
| **FinancialAgent** | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è push | LLM personalization |
| **DecisionAgent** | –ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è | LLM reasoning |

### Schemas (Pydantic)

–í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Pydantic:
- `PersonaGoal`, `PersonaAction`, `PersonaReaction`, `PersonaSessionRecord`
- `EmotionalStateSchema` (mood, stress, confidence, bank_trust, urgency)
- `ToolResponseSchema` (status, message, data)
- `FinancialPush`, `FinancialPrediction`
- `DecisionOutcome` (will_take_credit, reasoning, emotional_factors)

### Core Utilities

- **llm_utils.py**: `robust_llm_call()` —Å retry logic –∏ structured outputs
- **storage.py**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ JSON
- **visualization.py**: –ì—Ä–∞—Ñ–∏–∫–∏ –¥–∏–Ω–∞–º–∏–∫–∏ —ç–º–æ—Ü–∏–π (matplotlib)

---

## üî¨ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### PGM (Probabilistic Graphical Model)

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: pgmpy  
**–¢–∏–ø –º–æ–¥–µ–ª–∏**: Discrete Bayesian Network  
**–û–±—É—á–µ–Ω–∏–µ**: Maximum Likelihood Estimation  
**Inference**: Likelihood-weighted sampling

**–ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**:
```
age_group ‚Üí marital_status, children_group, education, income_level
education ‚Üí occupation, income_level
marital_status ‚Üí children_group
region_type ‚Üí income_level
occupation ‚Üí income_level
gender ‚Üí marital_status, income_level
```

### k-NN Matching

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: scipy.spatial.distance  
**–ú–µ—Ç—Ä–∏–∫–∞**: Euclidean distance (–ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏)  
**–ü—Ä–æ—Ü–µ—Å—Å**:
1. Category filtering (categorical exact match)
2. Distance computation (continuous features)
3. Top-k selection
4. OCEAN aggregation (mean + std)

### LLM Integration

**–ú–æ–¥–µ–ª—å**: OpenAI GPT (gpt-4)  
**–†–µ–∂–∏–º**: Structured outputs (JSON mode)  
**Retry**: –î–æ 3 –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API  
**Timeout**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π per-call

---